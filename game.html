<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PixiJS Camera Follow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/6.1.3/pixi.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        const app = new PIXI.Application({ 
            width: window.innerWidth, 
            height: window.innerHeight,
            backgroundColor: 0x000000
        });
        document.body.appendChild(app.view);

        let player;
        let cursors;
        let speedText;
        let pirateText;
        let water;
        let waterWidth = 0;
        let waterHeight = 0;
        let waterTileWidth = 200;
        let waterTileHeight = 200;

        function createPlayer() {
            const playerRadius = 50;
            player = new PIXI.Graphics();
            player.beginFill(0xffffff);
            player.drawCircle(0, 0, playerRadius);
            player.endFill();
            player.x = app.view.width / 2;
            player.y = app.view.height / 2;
            app.stage.addChild(player);

            // Добавляем текстовый объект для отображения скорости перемещения
            const textStyle = new PIXI.TextStyle({ fontFamily: 'Arial', fontSize: 20, fill: '#ff0000' });
            speedText = new PIXI.Text('', textStyle);
            speedText.x = player.x;
            speedText.y = player.y - playerRadius - 10;
            app.stage.addChild(speedText);

            // Добавляем текст "ПИРАТЫ" в правый верхний угол
            const pirateTextStyle = new PIXI.TextStyle({ fontFamily: 'Roboto', fontSize: 30, fill: '#ffffff' });
            pirateText = new PIXI.Text('ПИРАТЫ', pirateTextStyle);
            pirateText.x = app.view.width - 120;
            pirateText.y = 50;
            app.stage.addChild(pirateText);
        }

        function createWater() {
            const texture = PIXI.Texture.from('assets/water.png');
            water = new PIXI.TilingSprite(texture, waterTileWidth, waterTileHeight);
            app.stage.addChild(water);
        }

        function updateWaterPosition() {
            water.x = Math.floor(player.x / waterTileWidth) * waterTileWidth;
            water.y = Math.floor(player.y / waterTileHeight) * waterTileHeight;
            waterWidth = Math.ceil(app.view.width / waterTileWidth) * waterTileWidth;
            waterHeight = Math.ceil(app.view.height / waterTileHeight) * waterTileHeight;
            water.width = waterWidth;
            water.height = waterHeight;
        }

        function setup() {
            createWater();
            createPlayer();

            cursors = new PIXI.KeyboardManager();

            app.ticker.add(update);
        }

        function update() {
            // Обрабатываем ввод от пользователя с клавиатуры
            if (cursors.isKeyDown('ArrowLeft')) {
                player.x -= 5;
            } else if (cursors.isKeyDown('ArrowRight')) {
                player.x += 5;
            }

            if (cursors.isKeyDown('ArrowUp')) {
                player.y -= 5;
            } else if (cursors.isKeyDown('ArrowDown')) {
                player.y += 5;
            }

            // Плавное управление игроком к точке, куда тыкаем мышкой
            if (app.renderer.plugins.interaction.mouse.buttons) {
                const targetX = app.renderer.plugins.interaction.mouse.global.x;
                const targetY = app.renderer.plugins.interaction.mouse.global.y;
                const speed = 3;

                const directionX = targetX - player.x;
                const directionY = targetY - player.y;
                const distance = Math.sqrt(directionX * directionX + directionY * directionY);

                if (distance > 1) {
                    const directionXNormalized = directionX / distance;
                    const directionYNormalized = directionY / distance;

                    player.x += directionXNormalized * speed;
                    player.y += directionYNormalized * speed;

                    // Обновляем текстовый объект с текущей скоростью перемещения
                    speedText.x = player.x - speedText.width / 2; // Центрируем текст относительно игрока по горизонтали
                    speedText.y = player.y - 80;
                    speedText.text = `Speed: ${speed.toFixed(2)}`;

                    // Обновляем текстовый объект "ПИРАТЫ" в правом верхнем углу
                    pirateText.x = app.view.width - 120;
                    pirateText.y = 50;
                }
            }

            updateWaterPosition();
        }

        PIXI.Loader.shared.add('assets/water.png').load(setup);
    </script>
</body>
</html>
