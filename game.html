<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Phaser Camera Follow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.0/phaser.min.js"></script>
</head>
<body>
    <script>
        // Определяем размеры игровой сцены
        const gameConfig = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(gameConfig);

        let player;
        let cursors;
        let speedText;

        function preload() {
            // Загружаем текстуру для воды
            this.load.image('water', 'assets/water.png');
        }

        function create() {
            // Добавляем спрайт воды и устанавливаем его размеры равные размерам канваса
            const water = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'water').setOrigin(0);

            // Добавляем игрока (белый шарик) по центру экрана
            const playerRadius = 50;
            player = this.add.graphics();
            player.fillStyle(0xffffff, 1); // Белый цвет и непрозрачность 1 (полностью непрозрачный)
            player.fillCircle(game.config.width / 2, game.config.height / 2, playerRadius); // Радиус шарика - 50 пикселей
            cursors = this.input.keyboard.createCursorKeys();

            // Добавляем текстовый объект для отображения скорости перемещения
            speedText = this.add.text(player.x, player.y - playerRadius - 10, '', { fontFamily: 'Arial', fontSize: '20px', color: '#ffffff' });
            speedText.setDepth(1); // Задаем depth, чтобы текст всегда был видим над всеми другими элементами

            // Задаем камеру
            this.cameras.main.setBounds(0, 0, game.config.width, game.config.height);
            this.cameras.main.startFollow(player, true, 0.5, 0.5); // Камера следует за игроком с учетом смещения
        }

        function update() {
            // Плавное управление игроком к точке, куда тыкаем мышкой
            if (this.input.activePointer.isDown) {
                const targetX = this.input.activePointer.worldX;
                const targetY = this.input.activePointer.worldY;
                const speed = 3;

                const directionX = targetX - player.x;
                const directionY = targetY - player.y;
                const distance = Math.sqrt(directionX * directionX + directionY * directionY);

                if (distance > 1) {
                    const directionXNormalized = directionX / distance;
                    const directionYNormalized = directionY / distance;

                    player.x += directionXNormalized * speed;
                    player.y += directionYNormalized * speed;

                    // Обновляем текстовый объект с текущей скоростью перемещения
                    speedText.x = player.x;
                    speedText.y = player.y - playerRadius - 10;
                    speedText.setText(`Speed: ${speed.toFixed(2)}`);
                }
            }

            // Обрабатываем ввод от пользователя с клавиатуры
            if (cursors.left.isDown) {
                player.x -= 5;
            } else if (cursors.right.isDown) {
                player.x += 5;
            }

            if (cursors.up.isDown) {
                player.y -= 5;
            } else if (cursors.down.isDown) {
                player.y += 5;
            }
        }
    </script>
</body>
</html>
