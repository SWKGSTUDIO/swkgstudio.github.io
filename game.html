<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PixiJS Camera Follow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.4/pixi.min.js"></script>
</head>
<body>
    <script>
        // Создаем новую игровую сцену
        const app = new PIXI.Application({
            width: window.innerWidth,
            height: window.innerHeight
        });

        document.body.appendChild(app.view);

        let player;
        let cursors;
        let speedText;
        let pirateText;
        let water;
        let waterWidth = 0;
        let waterHeight = 0;
        let waterTileWidth = 200;
        let waterTileHeight = 200;

        // Загружаем текстуру для воды
        PIXI.Loader.shared.add('water', 'assets/water.png').load(setup);

        function setup() {
            // Создаем спрайт воды и устанавливаем его размеры равные размерам канваса
            water = new PIXI.TilingSprite(
                PIXI.Texture.from('water'),
                app.view.width,
                app.view.height
            );
            app.stage.addChild(water);

            // Добавляем игрока (белый шарик) по центру экрана
            const playerRadius = 50;
            player = new PIXI.Graphics();
            player.beginFill(0xffffff);
            player.drawCircle(0, 0, playerRadius);
            player.endFill();
            player.x = app.view.width / 2;
            player.y = app.view.height / 2;
            app.stage.addChild(player);

            cursors = app.renderer.plugins.interaction.keyboard;

            // Добавляем текстовый объект для отображения скорости перемещения
            speedText = new PIXI.Text('', { fontFamily: 'Arial', fontSize: 20, fill: '#ff0000' });
            speedText.anchor.set(0.5, 1); // Центрируем текст относительно игрока по горизонтали
            speedText.x = player.x;
            speedText.y = player.y - playerRadius - 10;
            app.stage.addChild(speedText);

            // Добавляем текст "ПИРАТЫ" в правый верхний угол
            pirateText = new PIXI.Text('ПИРАТЫ', { fontFamily: 'Roboto', fontSize: 30, fill: '#ffffff' });
            pirateText.x = app.view.width - 120;
            pirateText.y = 50;
            app.stage.addChild(pirateText);

            // Запускаем игровой цикл
            app.ticker.add(update);
        }

        function update() {
            // Обрабатываем ввод от пользователя с клавиатуры
            if (cursors.left.isDown) {
                player.x -= 5;
            } else if (cursors.right.isDown) {
                player.x += 5;
            }

            if (cursors.up.isDown) {
                player.y -= 5;
            } else if (cursors.down.isDown) {
                player.y += 5;
            }

            // Плавное управление игроком к точке, куда тыкаем мышкой
            if (app.renderer.plugins.interaction.mouse.global.x > 0 &&
                app.renderer.plugins.interaction.mouse.global.x < app.view.width &&
                app.renderer.plugins.interaction.mouse.global.y > 0 &&
                app.renderer.plugins.interaction.mouse.global.y < app.view.height) {
                const targetX = app.renderer.plugins.interaction.mouse.global.x;
                const targetY = app.renderer.plugins.interaction.mouse.global.y;
                const speed = 3;

                const directionX = targetX - player.x;
                const directionY = targetY - player.y;
                const distance = Math.sqrt(directionX * directionX + directionY * directionY);

                if (distance > 1) {
                    const directionXNormalized = directionX / distance;
                    const directionYNormalized = directionY / distance;

                    player.x += directionXNormalized * speed;
                    player.y += directionYNormalized * speed;

                    // Обновляем текстовый объект с текущей скоростью перемещения
                    speedText.text = `Speed: ${speed.toFixed(2)}`;
                    speedText.x = player.x;
                    speedText.y = player.y - 80;

                    // Обновляем текстовый объект "ПИРАТЫ" в правом верхнем углу
                    pirateText.x = app.view.width - 120;
                    pirateText.y = 50;

                    // Обновляем позицию и размеры спрайта воды в зависимости от положения игрока
                    water.x = Math.floor(player.x / waterTileWidth) * waterTileWidth;
                    water.y = Math.floor(player.y / waterTileHeight) * waterTileHeight;
                    waterWidth = Math.ceil(app.view.width / waterTileWidth) * waterTileWidth;
                    waterHeight = Math.ceil(app.view.height / waterTileHeight) * waterTileHeight;
                    water.width = waterWidth;
                    water.height = waterHeight;
                }
            }
        }
    </script>
</body>
</html>
