<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Корабль с камерой сзади</title>
  <!-- Ссылки на библиотеки three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://threejs.org/examples/jsm/objects/Water.js"></script>
  <script src="https://threejs.org/examples/jsm/objects/Sky.js"></script>
  <script src="https://threejs.org/examples/jsm/controls/OrbitControls.js"></script>
  <script src="https://threejs.org/examples/jsm/physics/ShipPhysics.js"></script>
</head>
<body>
  <!-- Тег script с кодом JavaScript -->
  <script>
    // Создаем сцену
    var scene = new THREE.Scene();

    // Создаем воду
    var waterGeometry = new THREE.PlaneBufferGeometry(1000, 1000);
    var water = new THREE.Water(waterGeometry, {
      color: 0x00a0d2,
      scale: 4,
      flowDirection: new THREE.Vector2(1, 1),
      textureWidth: 1024,
      textureHeight: 1024
    });
    water.rotation.x = -Math.PI / 2;
    scene.add(water);

    // Создаем небо
    var sky = new THREE.Sky();
    sky.scale.setScalar(1000);
    scene.add(sky);

    // Создаем корабль
    var shipGeometry = new THREE.BoxBufferGeometry(5, 2, 10);
    var shipMaterial = new THREE.MeshLambertMaterial({color: 0xff0000});
    var ship = new THREE.Mesh(shipGeometry, shipMaterial);
    ship.position.y = 1;
    scene.add(ship);

    // Создаем камеру и связываем ее с кораблем
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, -15);
    camera.lookAt(ship.position);
    ship.add(camera);

    // Создаем рендерер
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Создаем управление камерой
    var controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Создаем управление кораблем
    var shipControls = new THREE.ShipControls(ship, renderer.domElement);
    shipControls.movementSpeed = 10;
    shipControls.lookSpeed = 0.1;

    // Создаем физику и коллизии
    var physics = new THREE.ShipPhysics(ship, water);

    // Создаем звуки и эффекты
    var sound = new THREE.AudioListener();
    camera.add(sound);
    var engineSound = new THREE.Audio(sound);
    engineSound.setLoop(true);
    engineSound.setVolume(0.5);
    ship.add(engineSound);
    var waterSound = new THREE.Audio(sound);
    waterSound.setLoop(true);
    waterSound.setVolume(0.2);
    ship.add(waterSound);

    // Загружаем ассеты
    var loader = new THREE.AudioLoader();
    loader.load('engine.mp3', function(buffer) {
      engineSound.setBuffer(buffer);
      engineSound.play();
    });
    loader.load('water.mp3', function(buffer) {
      waterSound.setBuffer(buffer);
      waterSound.play();
    });

    // Анимируем сцену
    function animate() {
      requestAnimationFrame(animate);

      // Обновляем управление кораблем
      shipControls.update();

      // Обновляем физику
      physics.update();

      // Обновляем небо
      var time = performance.now();
      var sun = sky.sun;
      var uniforms = sky.material.uniforms;
      sun.position.copy(sky.sunSphere.position);
      uniforms['turbidity'].value = 10;
      uniforms['rayleigh'].value = 2;
      uniforms['luminance'].value = 1;
      uniforms['mieCoefficient'].value = 0.005;
      uniforms['mieDirectionalG'].value = 0.8;
      var distance = 400000;
      var uniforms = water.material.uniforms;
      uniforms['sunDirection'].value.copy(sun.position).normalize();
      uniforms['uSunColor'].value.copy(sun.color).multiplyScalar(sun.intensity);
      var cameraPos = camera.getWorldPosition();
      var fogColor = scene.fog.color;
      uniforms['cameraPos'].value.set(cameraPos.x, cameraPos.y, cameraPos.z);
      uniforms['fogColor'].value.set(fogColor.r, fogColor.g, fogColor.b);

      // Рендерим сцену
      renderer.render(scene, camera);
    }

    // Запускаем анимацию
    animate();
  </script>
</body>
</html>
