<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Phaser Camera Follow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.0/phaser.min.js"></script>
</head>
<body>
    <script>
        // Определяем размеры игровой сцены
        const gameConfig = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(gameConfig);

        let player;
        let cursors;

        function preload() {
            // Загружаем текстуру для воды
            this.load.image('water', 'assets/water.png');
        }

        function create() {
            // Добавляем спрайт воды и устанавливаем его размеры равные размерам канваса
            const water = this.add.tileSprite(0, 0, game.config.width, game.config.height, 'water').setOrigin(0);

            // Создаем графический объект для фона с волнами
            const waveGraphics = this.add.graphics();

            // Задаем параметры волн
            const waveColor = 0xffffff; // Белый цвет волн
            const waveWidth = 20; // Ширина волн
            const waveHeight = 10; // Высота волн
            const numWaves = Math.ceil(game.config.width / waveWidth); // Количество волн, чтобы заполнить ширину канваса

            // Рисуем волны
            for (let i = 0; i < numWaves; i++) {
                const startX = i * waveWidth;
                const startY = game.config.height;
                const controlX = startX + waveWidth / 2;
                const controlY = startY - waveHeight;
                const endX = startX + waveWidth;

                waveGraphics.lineStyle(2, waveColor, 1); // Устанавливаем стиль линии для волны
                waveGraphics.beginPath();
                waveGraphics.moveTo(startX, startY);
                waveGraphics.quadraticCurveTo(controlX, controlY, endX, startY);
                waveGraphics.strokePath();
            }

            // Добавляем игрока (белый шарик)
            player = this.add.graphics();
            player.fillStyle(0xffffff, 1); // Белый цвет и непрозрачность 1 (полностью непрозрачный)
            player.fillCircle(window.innerWidth / 2, window.innerHeight / 2, 50); // Радиус шарика - 50 пикселей
            cursors = this.input.keyboard.createCursorKeys();

            // Задаем камеру, чтобы она следовала за игроком
            this.cameras.main.startFollow(player);
        }

        function update() {
            // Плавное управление игроком к точке, куда тыкаем мышкой
            if (this.input.activePointer.isDown) {
                const targetX = this.input.activePointer.worldX;
                const targetY = this.input.activePointer.worldY;
                const speed = 3;

                const directionX = targetX - player.x;
                const directionY = targetY - player.y;
                const distance = Math.sqrt(directionX * directionX + directionY * directionY);

                if (distance > 1) {
                    const directionXNormalized = directionX / distance;
                    const directionYNormalized = directionY / distance;

                    player.x += directionXNormalized * speed;
                    player.y += directionYNormalized * speed;
                }
            }

            // Обрабатываем ввод от пользователя с клавиатуры
            if (cursors.left.isDown) {
                player.x -= 5;
            } else if (cursors.right.isDown) {
                player.x += 5;
            }

            if (cursors.up.isDown) {
                player.y -= 5;
            } else if (cursors.down.isDown) {
                player.y += 5;
            }
        }
    </script>
</body>
</html>
